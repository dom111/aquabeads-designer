(()=>{var kt=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var s=(r,e,t)=>(kt(r,e,"read from private field"),t?t.call(r):e.get(r)),b=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},f=(r,e,t,n)=>(kt(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);var C=(r,e,t)=>new Promise((n,a)=>{var i=p=>{try{o(t.next(p))}catch(c){a(c)}},u=p=>{try{o(t.throw(p))}catch(c){a(c)}},o=p=>p.done?n(p.value):Promise.resolve(p.value).then(i,u);o((t=t.apply(r,e)).next())});var d;(function(r){r.Attribute="attribute",r.Pseudo="pseudo",r.PseudoElement="pseudo-element",r.Tag="tag",r.Universal="universal",r.Adjacent="adjacent",r.Child="child",r.Descendant="descendant",r.Parent="parent",r.Sibling="sibling",r.ColumnCombinator="column-combinator"})(d||(d={}));var w;(function(r){r.Any="any",r.Element="element",r.End="end",r.Equals="equals",r.Exists="exists",r.Hyphen="hyphen",r.Not="not",r.Start="start"})(w||(w={}));var Lt=/^[^\\#]?(?:\\(?:[\da-f]{1,6}\s?|.)|[\w\-\u00b0-\uFFFF])+/,Qt=/\\([\da-f]{1,6}\s?|(\s)|.)/gi,Yt=new Map([[126,w.Element],[94,w.Start],[36,w.End],[42,w.Any],[33,w.Not],[124,w.Hyphen]]),_t=new Set(["has","not","matches","is","where","host","host-context"]);function Mt(r){switch(r.type){case d.Adjacent:case d.Child:case d.Descendant:case d.Parent:case d.Sibling:case d.ColumnCombinator:return!0;default:return!1}}var Vt=new Set(["contains","icontains"]);function zt(r,e,t){let n=parseInt(e,16)-65536;return n!==n||t?e:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,n&1023|56320)}function W(r){return r.replace(Qt,zt)}function I(r){return r===39||r===34}function Tt(r){return r===32||r===9||r===10||r===12||r===13}function tt(r){let e=[],t=xt(e,`${r}`,0);if(t<r.length)throw new Error(`Unmatched selector: ${r.slice(t)}`);return e}function xt(r,e,t){let n=[];function a(m){let l=e.slice(t+m).match(Lt);if(!l)throw new Error(`Expected name, found ${e.slice(t)}`);let[h]=l;return t+=m+h.length,W(h)}function i(m){for(t+=m;t<e.length&&Tt(e.charCodeAt(t));)t++}function u(){t+=1;let m=t,l=1;for(;l>0&&t<e.length;t++)e.charCodeAt(t)===40&&!o(t)?l++:e.charCodeAt(t)===41&&!o(t)&&l--;if(l)throw new Error("Parenthesis not matched");return W(e.slice(m,t-1))}function o(m){let l=0;for(;e.charCodeAt(--m)===92;)l++;return(l&1)===1}function p(){if(n.length>0&&Mt(n[n.length-1]))throw new Error("Did not expect successive traversals.")}function c(m){if(n.length>0&&n[n.length-1].type===d.Descendant){n[n.length-1].type=m;return}p(),n.push({type:m})}function M(m,l){n.push({type:d.Attribute,name:m,action:l,value:a(1),namespace:null,ignoreCase:"quirks"})}function D(){if(n.length&&n[n.length-1].type===d.Descendant&&n.pop(),n.length===0)throw new Error("Empty sub-selector");r.push(n)}if(i(0),e.length===t)return t;t:for(;t<e.length;){let m=e.charCodeAt(t);switch(m){case 32:case 9:case 10:case 12:case 13:{(n.length===0||n[0].type!==d.Descendant)&&(p(),n.push({type:d.Descendant})),i(1);break}case 62:{c(d.Child),i(1);break}case 60:{c(d.Parent),i(1);break}case 126:{c(d.Sibling),i(1);break}case 43:{c(d.Adjacent),i(1);break}case 46:{M("class",w.Element);break}case 35:{M("id",w.Equals);break}case 91:{i(1);let l,h=null;e.charCodeAt(t)===124?l=a(1):e.startsWith("*|",t)?(h="*",l=a(2)):(l=a(0),e.charCodeAt(t)===124&&e.charCodeAt(t+1)!==61&&(h=l,l=a(1))),i(0);let v=w.Exists,q=Yt.get(e.charCodeAt(t));if(q){if(v=q,e.charCodeAt(t+1)!==61)throw new Error("Expected `=`");i(2)}else e.charCodeAt(t)===61&&(v=w.Equals,i(1));let U="",F=null;if(v!=="exists"){if(I(e.charCodeAt(t))){let N=e.charCodeAt(t),k=t+1;for(;k<e.length&&(e.charCodeAt(k)!==N||o(k));)k+=1;if(e.charCodeAt(k)!==N)throw new Error("Attribute value didn't end");U=W(e.slice(t+1,k)),t=k+1}else{let N=t;for(;t<e.length&&(!Tt(e.charCodeAt(t))&&e.charCodeAt(t)!==93||o(t));)t+=1;U=W(e.slice(N,t))}i(0);let J=e.charCodeAt(t)|32;J===115?(F=!1,i(1)):J===105&&(F=!0,i(1))}if(e.charCodeAt(t)!==93)throw new Error("Attribute selector didn't terminate");t+=1;let O={type:d.Attribute,name:l,action:v,value:U,namespace:h,ignoreCase:F};n.push(O);break}case 58:{if(e.charCodeAt(t+1)===58){n.push({type:d.PseudoElement,name:a(2).toLowerCase(),data:e.charCodeAt(t)===40?u():null});continue}let l=a(1).toLowerCase(),h=null;if(e.charCodeAt(t)===40)if(_t.has(l)){if(I(e.charCodeAt(t+1)))throw new Error(`Pseudo-selector ${l} cannot be quoted`);if(h=[],t=xt(h,e,t+1),e.charCodeAt(t)!==41)throw new Error(`Missing closing parenthesis in :${l} (${e})`);t+=1}else{if(h=u(),Vt.has(l)){let v=h.charCodeAt(0);v===h.charCodeAt(h.length-1)&&I(v)&&(h=h.slice(1,-1))}h=W(h)}n.push({type:d.Pseudo,name:l,data:h});break}case 44:{D(),n=[],i(1);break}default:{if(e.startsWith("/*",t)){let v=e.indexOf("*/",t+2);if(v<0)throw new Error("Comment was not terminated");t=v+2,n.length===0&&i(0);break}let l=null,h;if(m===42)t+=1,h="*";else if(m===124){if(h="",e.charCodeAt(t+1)===124){c(d.ColumnCombinator),i(2);break}}else if(Lt.test(e.slice(t)))h=a(0);else break t;e.charCodeAt(t)===124&&e.charCodeAt(t+1)!==124&&(l=h,e.charCodeAt(t+1)===42?(h="*",t+=2):h=a(1)),n.push(h==="*"?{type:d.Universal,namespace:l}:{type:d.Tag,name:h,namespace:l})}}}return D(),t}var et=r=>{for(;r.hasChildNodes();)r.firstChild.remove()},y=(r,...e)=>{let[t]=tt(r).map(n=>n.reduce((a,i)=>{var u;return a===null&&i.type!=="tag"&&(a=document.createElement("div")),i.type==="tag"?document.createElement(i.name):(i.type==="attribute"&&i.name!=="class"&&a.setAttribute(i.name,(u=i.value)!=null?u:""),i.type==="attribute"&&i.name==="class"&&a.classList.add(i.value),a)},null));return e.forEach(n=>{n instanceof Q&&(n=n.element()),t.append(n)}),t},x=(r,e,t,n)=>r.addEventListener(e,t,n),nt=(r,e,t,n)=>{e.forEach(a=>x(r,a,t,n))},L=r=>document.createTextNode(r),$,rt=class{constructor(e,...t){b(this,$,void 0);f(this,$,y(e,...t))}addClass(...e){this.element().classList.add(...e)}append(...e){e.forEach(t=>{t instanceof rt&&(t=t.element()),this.element().append(t)})}element(){return s(this,$)}empty(){et(this.element())}on(e,t,n){x(this.element(),e,t,n)}onEach(e,t,n){nt(this.element(),e,t,n)}removeClass(...e){this.element().classList.remove(...e)}},Q=rt;$=new WeakMap;var g=Q;var at=class extends g{constructor(e){super('button.clear[title="Clear"]',L("\u274C")),this.onEach(["mousedown","touchstart"],()=>{e.clear(),window.location.hash=""})}},Pt=at;var X,it=class extends g{constructor(t){super('button.link[title="Generate link"]',L("\u{1F517}"));b(this,X,void 0);f(this,X,t),this.bindEvents()}bindEvents(){this.onEach(["mousedown","touchstart"],()=>this.saveState()),x(document,"keydown",t=>{["S","s"].includes(t.key)&&t.ctrlKey&&(this.saveState(),t.preventDefault(),t.stopPropagation())})}saveState(){s(this,X).toString().then(t=>window.location.hash="#"+t)}};X=new WeakMap;var Dt=it;var Ot=([r,e,t])=>"#"+(r*65536+e*256+t).toString(16).padStart(6,"0"),Zt=r=>r.slice(1).match(/../g).map(e=>parseInt(e,16)),st={},P=r=>{if(!(r in st)){let[e,t,n]=Zt(r);st[r]=Math.floor(Math.sqrt(e*e*.241+t*t*.691+n*n*.068))}return st[r]};var Y=r=>({data:e})=>{let t={};for(let a=0,i=e.length;a<i;a+=4){let u=e[a+3]===0,o=u?"transparent":Ot([e[a],e[a+1],e[a+2]]);o in t||(t[o]=0),t[o]++}let[n]=Object.entries(t).sort(r);return n[0]},Ht=Y(([r,e],[t,n])=>(t==="transparent"?0:Math.abs(P(t)-127))-(r==="transparent"?0:Math.abs(P(r)-127))),be=Y(([r,e],[t,n])=>(t==="transparent"?0:P(t))-(r==="transparent"?0:P(r))),ve=Y(([r,e],[t,n])=>(r==="transparent"?255:P(r))-(t==="transparent"?255:P(t))),we=Y(([r,e],[t,n])=>n-e||(r==="transparent"?0:P(r))-(t==="transparent"?0:P(t)));var ot=class extends g{static processFile(e,t,n){return C(this,null,function*(){return new Promise(a=>{let i=new FileReader;i.addEventListener("load",()=>a(i.result)),i.readAsDataURL(e)}).then(a=>new Promise((i,u)=>{let o=new Image;o.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKAQMAAAC3/F3+AAAAA1BMVEUAAACnej3aAAAAAXRSTlPHReaPdQAAAApJREFUCNdjwAsAAB4AAdpxxYoAAAAASUVORK5CYII=",o.addEventListener("error",p=>u(p.error)),o.addEventListener("load",()=>i(o)),o.src=a})).then(a=>this.processImageData(a,t,n))})}static processImageData(e,{height:t,width:n},a){var F;let i=e.height,u=e.width,o=Math.floor(Math.min(i/t,u/n)),p=o*t,c=o*n,M=(c-o)/u/2,D=(u-c)/2,m=(i-p)/2,l=document.createElement("canvas"),h=l.getContext("2d"),v=document.createElement("canvas"),q=v.getContext("2d"),U=[];v.height=o,v.width=o,l.height=p,l.width=c,h.drawImage(e,D,m,c,p);for(let O=0;O<t;O++){let J=n-O%2,N=O%2*M;for(let k=0;k<J;k++){let $t=D+N+k*o,Xt=m+O*o;q.clearRect(0,0,o,o),q.drawImage(l,$t,Xt,o,o,0,0,o,o);let Jt=(F=document.querySelector(".debug-container"))!=null?F:(()=>{let Z=document.createElement("div");return Z.classList.add("debug-container"),document.body.append(Z),Z})(),z=new Image;z.src=v.toDataURL("image/png"),Jt.append(z);let St=a(q.getImageData(0,0,o,o));z.setAttribute("data-colour",St),U.push(St)}}return U}},Bt=ot;var ut=16,S,H,T,lt=class extends g{constructor(t){super("section.picker");b(this,S,void 0);b(this,H,void 0);b(this,T,void 0);f(this,T,t.palette()),f(this,S,y('input[type="color"]')),s(this,S).value=s(this,T)[0],f(this,H,y("section.recent")),this.append(s(this,S),s(this,H)),this.bindEvents(),this.updateRecent()}bindEvents(){x(s(this,S),"input",()=>this.setCurrentColour(s(this,S).value))}currentColour(){return s(this,S).value}setCurrentColour(t){s(this,S).value!==t&&(s(this,S).value=t);let n=s(this,T).indexOf(t);n>-1&&s(this,T).splice(n,1),s(this,T).unshift(t),s(this,T).splice(ut),this.updateRecent()}updateRecent(){et(s(this,H)),s(this,H).append(...s(this,T).map(t=>{let n=y("button");return n.style.backgroundColor=t,nt(n,["mousedown","touchstart"],()=>s(this,S).value=t),n}))}};S=new WeakMap,H=new WeakMap,T=new WeakMap;var Rt=lt;var ct=class extends g{constructor(e,t){super("span.import-image-wrapper",y('button.import-image[title="Import image"][tabindex="-1"]',L("\u{1F5BC}")));let n=y('input[type="file"][accept="image/*"]');this.onEach(["mousedown","touchstart"],()=>n.click()),n.addEventListener("change",()=>C(this,null,function*(){let[a]=n.files;!a.type.match(/image/)||Bt.processFile(a,t.board(),Ht).then(i=>{let u=[],o=[],p={};n.value="",i.forEach((c,M)=>{o.includes(c)||o.push(c),u.push(o.indexOf(c)),c in p||(p[c]=0),p[c]++}),t.toString({board:t.board(),entries:u,lookup:o,palette:Object.entries(p).sort(([,c],[,M])=>c-M).map(([c])=>c).slice(0,ut)}).then(c=>window.location.hash="#"+c)})})),this.append(n)}},qt=ct;var ht=class extends g{constructor(){super('button.print[title="Print design"]',L("\u{1F5A8}")),this.onEach(["mousedown","touchstart"],()=>window.print())}},Ut=ht;var pt=class extends g{constructor(e){super('button.print[title="Share design"]'),this.element().innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 458.624 458.624" width="95"><path d="M339.588 314.529a71.683 71.683 0 0 0-38.621 11.239l-112.682-78.67a72.036 72.036 0 0 0 2.798-19.871c0-6.896-.989-13.557-2.798-19.871l109.64-76.547c11.764 8.356 26.133 13.286 41.662 13.286 39.79 0 72.047-32.257 72.047-72.047S379.378 0 339.588 0c-39.79 0-72.047 32.257-72.047 72.047 0 5.255.578 10.373 1.646 15.308l-112.424 78.491c-10.974-6.759-23.892-10.666-37.727-10.666-39.79 0-72.047 32.257-72.047 72.047s32.256 72.047 72.047 72.047c13.834 0 26.753-3.907 37.727-10.666l113.292 79.097a72.108 72.108 0 0 0-2.514 18.872c0 39.79 32.257 72.047 72.047 72.047s72.047-32.257 72.047-72.047-32.257-72.048-72.047-72.048z"/></svg>',this.onEach(["mousedown","touchstart"],()=>C(this,null,function*(){return navigator.share({text:"Check out my Aquabeads\xAE design!",title:"Aquabeads\xAE Designer",url:"#"+(yield e.toString())})}))}},Ft=pt;var mt=class extends g{constructor(e,t){super("section.actions");let n=new Pt(e),a=new Dt(t),i=new Ut,u=new qt(e,t),o=new Ft(t);this.append(n,a,i,u),navigator.share&&this.append(o)}},Nt=mt;var B,K,G,j,dt=class extends g{constructor(t,n,a){super(".cell");b(this,B,"transparent");b(this,K,void 0);b(this,G,void 0);b(this,j,void 0);f(this,K,a),f(this,G,t),f(this,j,n),this.paint(a.getEntry(t,n))}clear(){this.paint("transparent")}currentColour(){return s(this,B)}paint(t){f(this,B,t),this.element().style.backgroundColor=s(this,B),s(this,K).getEntry(s(this,G),s(this,j))!==t&&s(this,K).setEntry(s(this,G),s(this,j),s(this,B))}};B=new WeakMap,K=new WeakMap,G=new WeakMap,j=new WeakMap;var Kt=dt;var It=(r,e)=>{let t=document.elementFromPoint(r,e);return t.matches(".cell")?t:null},ft=r=>{r instanceof HTMLElement&&r.classList.add("focus")},gt=r=>{r instanceof HTMLElement&&r.classList.remove("focus")},R,E,Et=class extends g{constructor(t,n){super('section.board[tabindex="0"][aria-title="Bead board"][aria-description="The board can be navigated using the keyboard (arrow keys or WASD) and the current colour bead can be placed with Enter or Space and cleared using Backspace or Delete."]');b(this,R,void 0);b(this,E,void 0);let{height:a,width:i}=n.board();f(this,R,this.generateCells(a,i,n)),s(this,R).forEach(u=>this.append(y(".row",...u.map(o=>o.element())))),this.bindEvents(t)}bindEvents(t){this.on("focus",()=>{var n;f(this,E,(n=s(this,E))!=null?n:this.element().querySelector(".cell")),ft(s(this,E))}),this.on("keydown",n=>{if(!["ArrowUp","ArrowLeft","ArrowDown","ArrowRight","W","A","S","D","w","a","s","d"," ","Enter","Delete","Backspace"].includes(n.key))return;n.preventDefault(),s(this,E)||f(this,E,this.element().querySelector(".cell"));let a=s(this,E).parentElement,i=[...a.childNodes].indexOf(s(this,E)),u=a.previousElementSibling,o=a.nextElementSibling,p=u==null?void 0:u.childNodes[i],c=o==null?void 0:o.childNodes[i],M=s(this,E).previousElementSibling,D=s(this,E).nextElementSibling;[[["ArrowUp","W","w"].includes(n.key),p],[["ArrowLeft","A","a"].includes(n.key),M],[["ArrowDown","S","s"].includes(n.key),c],[["ArrowRight","D","d"].includes(n.key),D]].forEach(([m,l])=>{!m||!l||(gt(s(this,E)),f(this,E,l),ft(s(this,E)))}),[" ","Enter"].includes(n.key)&&this.cellFromElement(s(this,E)).paint(t.currentColour()),["Delete","Backspace"].includes(n.key)&&this.cellFromElement(s(this,E)).clear()}),x(document,"keydown",n=>{n.key==="Control"&&this.addClass("pick")}),x(document,"keyup",n=>{n.key==="Control"&&this.removeClass("pick")}),this.onEach(["mousedown","mousemove"],n=>this.handleMouseEvent(n,t)),this.onEach(["blur","mouseout"],()=>{gt(s(this,E)),f(this,E,null)}),this.onEach(["touchstart","touchmove"],n=>this.handleTouchEvent(n,t)),this.on("contextmenu",n=>n.preventDefault())}cellFromElement(t){let[n]=s(this,R).flat().filter(a=>a.element()===t);return n!=null?n:null}clear(){s(this,R).flat().forEach(t=>t.clear())}generateCells(t,n,a){return new Array(t).fill(0).map((i,u)=>new Array(n-u%2).fill(0).map((o,p)=>new Kt(p,u,a)))}handlePaintEvent(t,n){let a=this.cellFromElement(t);if(this.element().classList.contains("pick")){n.setCurrentColour(a.currentColour());return}a.paint(n.currentColour())}handleMouseEvent(t,n){let a=t.target;!a||!a.matches(".cell")||(this.handleMoveEvent(a),t.buttons&1&&this.handlePaintEvent(a,n),t.buttons&2&&(this.cellFromElement(a).clear(),t.stopPropagation()),t.preventDefault())}handleMoveEvent(t){gt(s(this,E)),f(this,E,t),ft(s(this,E))}handleTouchEvent(t,n){[...t.touches].forEach(a=>{let i=It(a.pageX,a.pageY);!i||!i.matches(".cell")||(this.handleMoveEvent(i),this.handlePaintEvent(i,n),t.preventDefault())})}};R=new WeakMap,E=new WeakMap;var Gt=Et;var bt=class extends g{constructor(){super("p.footer",y("small",L("This site is not affiliated with Aquabeads\xAE or EPOCH. Aquabeads\xAE is a registered trademark of EPOCH.")))}},jt=bt;var vt=class{static encode(e){return C(this,null,function*(){return new Promise(t=>{let n=new FileReader;n.addEventListener("load",()=>t(n.result)),n.readAsDataURL(new Blob([e]))}).then(t=>t.split(",",2)[1])})}static decode(e){let t=`data:application/octet-binary;base64,${e}`;return fetch(t).then(n=>n.arrayBuffer()).then(n=>new Uint8Array(n))}},wt=vt;var At=class{static compress(e,t="deflate"){let n=new TextEncoder().encode(e),a=new CompressionStream(t),i=a.writable.getWriter();return i.write(n),i.close(),new Response(a.readable).arrayBuffer().then(u=>new Uint8Array(u))}static decompress(e,t="deflate"){let n=new DecompressionStream(t),a=n.writable.getWriter();return a.write(e),a.close(),new Response(n.readable).arrayBuffer().then(i=>new TextDecoder().decode(i))}static isAvailable(){return"CompressionStream"in window&&"DecompressionStream"in window}},_=At;var te=(r=26,e=22)=>({board:{height:r,width:e},entries:new Array(r*e-Math.floor(r/2)).fill(0),lookup:["transparent"],palette:["#ff0000","#ff8800","#ffff88","#ffff00","#88ff00","#00ff88","#88ffff","#00ffff","#0088ff","#8800ff","#ff00ff","#ff0088","#ff88ff","#000000","#888888","#ffffff"]}),A,yt=class{constructor(){b(this,A,te())}board(){return s(this,A).board}coordsToIndex(e,t){let{width:n}=this.board();return n*t-Math.floor(t/2)+e}static fromString(e){return C(this,null,function*(){if(e.length<3)return null;try{return JSON.parse(atob(e))}catch(t){}try{return JSON.parse(yield _.decompress(yield wt.decode(e)))}catch(t){return console.debug("There was an error decoding the hash state:"),console.debug(t),null}})}init(e=null){return C(this,null,function*(){let t=yield yt.fromString(e);!t||f(this,A,t)})}getEntry(e,t){return s(this,A).lookup[s(this,A).entries[this.coordsToIndex(e,t)]]}palette(){return s(this,A).palette}setEntry(e,t,n){s(this,A).lookup.includes(n)||s(this,A).lookup.push(n),s(this,A).entries[this.coordsToIndex(e,t)]=s(this,A).lookup.indexOf(n)}toString(){return C(this,arguments,function*(e=s(this,A)){return _.isAvailable()?_.compress(JSON.stringify(e)).then(t=>wt.encode(t)):btoa(JSON.stringify(e))})}},Ct=yt;A=new WeakMap;var Wt=Ct;var V=new Wt;V.init(window.location.hash.slice(1)).then(()=>{let r=new Rt(V),e=new Gt(r,V),t=new Nt(e,V),n=new jt;document.getElementById("app").append(t.element(),e.element(),r.element(),n.element())});window.addEventListener("hashchange",()=>window.location.reload());})();
//# sourceMappingURL=app.js.map
