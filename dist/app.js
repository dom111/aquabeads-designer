(()=>{var St=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var s=(r,e,t)=>(St(r,e,"read from private field"),t?t.call(r):e.get(r)),b=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},f=(r,e,t,n)=>(St(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);var C=(r,e,t)=>new Promise((n,a)=>{var i=p=>{try{o(t.next(p))}catch(h){a(h)}},u=p=>{try{o(t.throw(p))}catch(h){a(h)}},o=p=>p.done?n(p.value):Promise.resolve(p.value).then(i,u);o((t=t.apply(r,e)).next())});var d;(function(r){r.Attribute="attribute",r.Pseudo="pseudo",r.PseudoElement="pseudo-element",r.Tag="tag",r.Universal="universal",r.Adjacent="adjacent",r.Child="child",r.Descendant="descendant",r.Parent="parent",r.Sibling="sibling",r.ColumnCombinator="column-combinator"})(d||(d={}));var w;(function(r){r.Any="any",r.Element="element",r.End="end",r.Equals="equals",r.Exists="exists",r.Hyphen="hyphen",r.Not="not",r.Start="start"})(w||(w={}));var kt=/^[^\\#]?(?:\\(?:[\da-f]{1,6}\s?|.)|[\w\-\u00b0-\uFFFF])+/,$t=/\\([\da-f]{1,6}\s?|(\s)|.)/gi,Xt=new Map([[126,w.Element],[94,w.Start],[36,w.End],[42,w.Any],[33,w.Not],[124,w.Hyphen]]),Jt=new Set(["has","not","matches","is","where","host","host-context"]);function Tt(r){switch(r.type){case d.Adjacent:case d.Child:case d.Descendant:case d.Parent:case d.Sibling:case d.ColumnCombinator:return!0;default:return!1}}var Qt=new Set(["contains","icontains"]);function Yt(r,e,t){let n=parseInt(e,16)-65536;return n!==n||t?e:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,n&1023|56320)}function j(r){return r.replace($t,Yt)}function z(r){return r===39||r===34}function Lt(r){return r===32||r===9||r===10||r===12||r===13}function Z(r){let e=[],t=Mt(e,`${r}`,0);if(t<r.length)throw new Error(`Unmatched selector: ${r.slice(t)}`);return e}function Mt(r,e,t){let n=[];function a(m){let l=e.slice(t+m).match(kt);if(!l)throw new Error(`Expected name, found ${e.slice(t)}`);let[c]=l;return t+=m+c.length,j(c)}function i(m){for(t+=m;t<e.length&&Lt(e.charCodeAt(t));)t++}function u(){t+=1;let m=t,l=1;for(;l>0&&t<e.length;t++)e.charCodeAt(t)===40&&!o(t)?l++:e.charCodeAt(t)===41&&!o(t)&&l--;if(l)throw new Error("Parenthesis not matched");return j(e.slice(m,t-1))}function o(m){let l=0;for(;e.charCodeAt(--m)===92;)l++;return(l&1)===1}function p(){if(n.length>0&&Tt(n[n.length-1]))throw new Error("Did not expect successive traversals.")}function h(m){if(n.length>0&&n[n.length-1].type===d.Descendant){n[n.length-1].type=m;return}p(),n.push({type:m})}function T(m,l){n.push({type:d.Attribute,name:m,action:l,value:a(1),namespace:null,ignoreCase:"quirks"})}function H(){if(n.length&&n[n.length-1].type===d.Descendant&&n.pop(),n.length===0)throw new Error("Empty sub-selector");r.push(n)}if(i(0),e.length===t)return t;t:for(;t<e.length;){let m=e.charCodeAt(t);switch(m){case 32:case 9:case 10:case 12:case 13:{(n.length===0||n[0].type!==d.Descendant)&&(p(),n.push({type:d.Descendant})),i(1);break}case 62:{h(d.Child),i(1);break}case 60:{h(d.Parent),i(1);break}case 126:{h(d.Sibling),i(1);break}case 43:{h(d.Adjacent),i(1);break}case 46:{T("class",w.Element);break}case 35:{T("id",w.Equals);break}case 91:{i(1);let l,c=null;e.charCodeAt(t)===124?l=a(1):e.startsWith("*|",t)?(c="*",l=a(2)):(l=a(0),e.charCodeAt(t)===124&&e.charCodeAt(t+1)!==61&&(c=l,l=a(1))),i(0);let v=w.Exists,U=Xt.get(e.charCodeAt(t));if(U){if(v=U,e.charCodeAt(t+1)!==61)throw new Error("Expected `=`");i(2)}else e.charCodeAt(t)===61&&(v=w.Equals,i(1));let F="",M=null;if(v!=="exists"){if(z(e.charCodeAt(t))){let O=e.charCodeAt(t),x=t+1;for(;x<e.length&&(e.charCodeAt(x)!==O||o(x));)x+=1;if(e.charCodeAt(x)!==O)throw new Error("Attribute value didn't end");F=j(e.slice(t+1,x)),t=x+1}else{let O=t;for(;t<e.length&&(!Lt(e.charCodeAt(t))&&e.charCodeAt(t)!==93||o(t));)t+=1;F=j(e.slice(O,t))}i(0);let X=e.charCodeAt(t)|32;X===115?(M=!1,i(1)):X===105&&(M=!0,i(1))}if(e.charCodeAt(t)!==93)throw new Error("Attribute selector didn't terminate");t+=1;let V={type:d.Attribute,name:l,action:v,value:F,namespace:c,ignoreCase:M};n.push(V);break}case 58:{if(e.charCodeAt(t+1)===58){n.push({type:d.PseudoElement,name:a(2).toLowerCase(),data:e.charCodeAt(t)===40?u():null});continue}let l=a(1).toLowerCase(),c=null;if(e.charCodeAt(t)===40)if(Jt.has(l)){if(z(e.charCodeAt(t+1)))throw new Error(`Pseudo-selector ${l} cannot be quoted`);if(c=[],t=Mt(c,e,t+1),e.charCodeAt(t)!==41)throw new Error(`Missing closing parenthesis in :${l} (${e})`);t+=1}else{if(c=u(),Qt.has(l)){let v=c.charCodeAt(0);v===c.charCodeAt(c.length-1)&&z(v)&&(c=c.slice(1,-1))}c=j(c)}n.push({type:d.Pseudo,name:l,data:c});break}case 44:{H(),n=[],i(1);break}default:{if(e.startsWith("/*",t)){let v=e.indexOf("*/",t+2);if(v<0)throw new Error("Comment was not terminated");t=v+2,n.length===0&&i(0);break}let l=null,c;if(m===42)t+=1,c="*";else if(m===124){if(c="",e.charCodeAt(t+1)===124){h(d.ColumnCombinator),i(2);break}}else if(kt.test(e.slice(t)))c=a(0);else break t;e.charCodeAt(t)===124&&e.charCodeAt(t+1)!==124&&(l=c,e.charCodeAt(t+1)===42?(c="*",t+=2):c=a(1)),n.push(c==="*"?{type:d.Universal,namespace:l}:{type:d.Tag,name:c,namespace:l})}}}return H(),t}var I=r=>{for(;r.hasChildNodes();)r.firstChild.remove()},y=(r,...e)=>{let[t]=Z(r).map(n=>n.reduce((a,i)=>{var u;return a===null&&i.type!=="tag"&&(a=document.createElement("div")),i.type==="tag"?document.createElement(i.name):(i.type==="attribute"&&i.name!=="class"&&a.setAttribute(i.name,(u=i.value)!=null?u:""),i.type==="attribute"&&i.name==="class"&&a.classList.add(i.value),a)},null));return e.forEach(n=>{n instanceof J&&(n=n.element()),t.append(n)}),t},P=(r,e,t,n)=>r.addEventListener(e,t,n),tt=(r,e,t,n)=>{e.forEach(a=>P(r,a,t,n))},k=r=>document.createTextNode(r),W,et=class{constructor(e,...t){b(this,W,void 0);f(this,W,y(e,...t))}addClass(...e){this.element().classList.add(...e)}append(...e){e.forEach(t=>{t instanceof et&&(t=t.element()),this.element().append(t)})}element(){return s(this,W)}empty(){I(this.element())}on(e,t,n){P(this.element(),e,t,n)}onEach(e,t,n){tt(this.element(),e,t,n)}removeClass(...e){this.element().classList.remove(...e)}},J=et;W=new WeakMap;var g=J;var nt=class extends g{constructor(e){super('button.clear[title="Clear"]',k("\u274C")),this.onEach(["mousedown","touchstart"],()=>{e.clear(),window.location.hash=""})}},xt=nt;var $,rt=class extends g{constructor(t){super('button.link[title="Generate link"]',k("\u{1F517}"));b(this,$,void 0);f(this,$,t),this.bindEvents()}bindEvents(){this.onEach(["mousedown","touchstart"],()=>this.saveState()),P(document,"keydown",t=>{["S","s"].includes(t.key)&&t.ctrlKey&&(this.saveState(),t.preventDefault(),t.stopPropagation())})}saveState(){s(this,$).toString().then(t=>window.location.hash="#"+t)}};$=new WeakMap;var Pt=rt;var Dt=([r,e,t])=>"#"+(r*65536+e*256+t).toString(16).padStart(6,"0"),_t=r=>r.slice(1).match(/../g).map(e=>parseInt(e,16)),at={},D=r=>{if(!(r in at)){let[e,t,n]=_t(r);at[r]=Math.floor(Math.sqrt(e*e*.241+t*t*.691+n*n*.068))}return at[r]};var Q=r=>({data:e})=>{let t={};for(let a=0,i=e.length;a<i;a+=4){let u=e[a+3]===0,o=u?"transparent":Dt([e[a],e[a+1],e[a+2]]);o in t||(t[o]=0),t[o]++}let[n]=Object.entries(t).sort(r);return n[0]},Ot=Q(([r,e],[t,n])=>(t==="transparent"?0:Math.abs(D(t)-127))-(r==="transparent"?0:Math.abs(D(r)-127))),fe=Q(([r,e],[t,n])=>(t==="transparent"?0:D(t))-(r==="transparent"?0:D(r))),ge=Q(([r,e],[t,n])=>(r==="transparent"?255:D(r))-(t==="transparent"?255:D(t))),Ee=Q(([r,e],[t,n])=>n-e||(r==="transparent"?0:D(r))-(t==="transparent"?0:D(t)));var it=class extends g{static processFile(e,t,n){return C(this,null,function*(){return new Promise(a=>{let i=new FileReader;i.addEventListener("load",()=>a(i.result)),i.readAsDataURL(e)}).then(a=>new Promise((i,u)=>{let o=new Image;o.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKAQMAAAC3/F3+AAAAA1BMVEUAAACnej3aAAAAAXRSTlPHReaPdQAAAApJREFUCNdjwAsAAB4AAdpxxYoAAAAASUVORK5CYII=",o.addEventListener("error",p=>u(p.error)),o.addEventListener("load",()=>i(o)),o.src=a})).then(a=>this.processImageData(a,t,n))})}static processImageData(e,{height:t,width:n},a){let i=e.height,u=e.width,o=Math.floor(Math.min(i/t,u/n)),p=o*t,h=o*n,T=(h-o)/u/2,H=(u-h)/2,m=(i-p)/2,l=document.createElement("canvas"),c=l.getContext("2d"),v=document.createElement("canvas"),U=v.getContext("2d"),F=[];v.height=o,v.width=o,l.height=p,l.width=h,c.drawImage(e,H,m,h,p);for(let M=0;M<t;M++){let V=n-M%2,X=M%2*T;for(let O=0;O<V;O++){let x=H+X+O*o,Wt=m+M*o;U.clearRect(0,0,o,o),U.drawImage(l,x,Wt,o,o,0,0,o,o);let Ct=new Image;Ct.src=v.toDataURL("image/png");let yt=a(U.getImageData(0,0,o,o));Ct.setAttribute("data-colour",yt),F.push(yt)}}return F}},Ht=it;var ot=16,S,B,L,st=class extends g{constructor(t){super("section.picker");b(this,S,void 0);b(this,B,void 0);b(this,L,void 0);f(this,L,t.palette()),f(this,S,y('input[type="color"]')),s(this,S).value=s(this,L)[0],f(this,B,y("section.recent")),this.append(s(this,S),s(this,B)),this.bindEvents(),this.updateRecent()}bindEvents(){P(s(this,S),"input",()=>this.setCurrentColour(s(this,S).value))}currentColour(){return s(this,S).value}setCurrentColour(t){s(this,S).value!==t&&(s(this,S).value=t);let n=s(this,L).indexOf(t);n>-1&&s(this,L).splice(n,1),s(this,L).unshift(t),s(this,L).splice(ot),this.updateRecent()}updateRecent(){I(s(this,B)),s(this,B).append(...s(this,L).map(t=>{let n=y("button");return n.style.backgroundColor=t,tt(n,["mousedown","touchstart"],()=>s(this,S).value=t),n}))}};S=new WeakMap,B=new WeakMap,L=new WeakMap;var Bt=st;var lt=class extends g{constructor(e,t){super("span.import-image-wrapper",y('button.import-image[title="Import image"][tabindex="-1"]',k("\u{1F5BC}")));let n=y('input[type="file"][accept="image/*"]');this.onEach(["mousedown","touchstart"],()=>n.click()),n.addEventListener("change",()=>C(this,null,function*(){let[a]=n.files;!a.type.match(/image/)||Ht.processFile(a,t.board(),Ot).then(i=>{let u=[],o=[],p={};n.value="",i.forEach((h,T)=>{o.includes(h)||o.push(h),u.push(o.indexOf(h)),h in p||(p[h]=0),p[h]++}),t.toString({board:t.board(),entries:u,lookup:o,palette:Object.entries(p).sort(([,h],[,T])=>h-T).map(([h])=>h).slice(0,ot)}).then(h=>window.location.hash="#"+h)})})),this.append(n)}},Rt=lt;var ut=class extends g{constructor(){super('button.print[title="Print design"]',k("\u{1F5A8}")),this.onEach(["mousedown","touchstart"],()=>window.print())}},qt=ut;var ht=class extends g{constructor(e){super('button.print[title="Share design"]'),this.element().innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 458.624 458.624" width="95"><path d="M339.588 314.529a71.683 71.683 0 0 0-38.621 11.239l-112.682-78.67a72.036 72.036 0 0 0 2.798-19.871c0-6.896-.989-13.557-2.798-19.871l109.64-76.547c11.764 8.356 26.133 13.286 41.662 13.286 39.79 0 72.047-32.257 72.047-72.047S379.378 0 339.588 0c-39.79 0-72.047 32.257-72.047 72.047 0 5.255.578 10.373 1.646 15.308l-112.424 78.491c-10.974-6.759-23.892-10.666-37.727-10.666-39.79 0-72.047 32.257-72.047 72.047s32.256 72.047 72.047 72.047c13.834 0 26.753-3.907 37.727-10.666l113.292 79.097a72.108 72.108 0 0 0-2.514 18.872c0 39.79 32.257 72.047 72.047 72.047s72.047-32.257 72.047-72.047-32.257-72.048-72.047-72.048z"/></svg>',this.onEach(["mousedown","touchstart"],()=>C(this,null,function*(){return navigator.share({text:"Check out my Aquabeads\xAE design!",title:"Aquabeads\xAE Designer",url:"#"+(yield e.toString())})}))}},Ut=ht;var ct=class extends g{constructor(e,t){super("section.actions");let n=new xt(e),a=new Pt(t),i=new qt,u=new Rt(e,t),o=new Ut(t);this.append(n,a,i,u),navigator.share&&this.append(o)}},Ft=ct;var R,N,K,G,pt=class extends g{constructor(t,n,a){super(".cell");b(this,R,"transparent");b(this,N,void 0);b(this,K,void 0);b(this,G,void 0);f(this,N,a),f(this,K,t),f(this,G,n),this.paint(a.getEntry(t,n))}clear(){this.paint("transparent")}currentColour(){return s(this,R)}paint(t){f(this,R,t),this.element().style.backgroundColor=s(this,R),s(this,N).getEntry(s(this,K),s(this,G))!==t&&s(this,N).setEntry(s(this,K),s(this,G),s(this,R))}};R=new WeakMap,N=new WeakMap,K=new WeakMap,G=new WeakMap;var Nt=pt;var Vt=(r,e)=>{let t=document.elementFromPoint(r,e);return t.matches(".cell")?t:null},mt=r=>{r instanceof HTMLElement&&r.classList.add("focus")},dt=r=>{r instanceof HTMLElement&&r.classList.remove("focus")},q,E,ft=class extends g{constructor(t,n){super('section.board[tabindex="0"][aria-title="Bead board"][aria-description="The board can be navigated using the keyboard (arrow keys or WASD) and the current colour bead can be placed with Enter or Space and cleared using Backspace or Delete."]');b(this,q,void 0);b(this,E,void 0);let{height:a,width:i}=n.board();f(this,q,this.generateCells(a,i,n)),s(this,q).forEach(u=>this.append(y(".row",...u.map(o=>o.element())))),this.bindEvents(t)}bindEvents(t){this.on("focus",()=>{var n;f(this,E,(n=s(this,E))!=null?n:this.element().querySelector(".cell")),mt(s(this,E))}),this.on("keydown",n=>{if(!["ArrowUp","ArrowLeft","ArrowDown","ArrowRight","W","A","S","D","w","a","s","d"," ","Enter","Delete","Backspace"].includes(n.key))return;n.preventDefault(),s(this,E)||f(this,E,this.element().querySelector(".cell"));let a=s(this,E).parentElement,i=[...a.childNodes].indexOf(s(this,E)),u=a.previousElementSibling,o=a.nextElementSibling,p=u==null?void 0:u.childNodes[i],h=o==null?void 0:o.childNodes[i],T=s(this,E).previousElementSibling,H=s(this,E).nextElementSibling;[[["ArrowUp","W","w"].includes(n.key),p],[["ArrowLeft","A","a"].includes(n.key),T],[["ArrowDown","S","s"].includes(n.key),h],[["ArrowRight","D","d"].includes(n.key),H]].forEach(([m,l])=>{!m||!l||(dt(s(this,E)),f(this,E,l),mt(s(this,E)))}),[" ","Enter"].includes(n.key)&&this.cellFromElement(s(this,E)).paint(t.currentColour()),["Delete","Backspace"].includes(n.key)&&this.cellFromElement(s(this,E)).clear()}),P(document,"keydown",n=>{n.key==="Control"&&this.addClass("pick")}),P(document,"keyup",n=>{n.key==="Control"&&this.removeClass("pick")}),this.onEach(["mousedown","mousemove"],n=>this.handleMouseEvent(n,t)),this.onEach(["blur","mouseout"],()=>{dt(s(this,E)),f(this,E,null)}),this.onEach(["touchstart","touchmove"],n=>this.handleTouchEvent(n,t)),this.on("contextmenu",n=>n.preventDefault())}cellFromElement(t){let[n]=s(this,q).flat().filter(a=>a.element()===t);return n!=null?n:null}clear(){s(this,q).flat().forEach(t=>t.clear())}generateCells(t,n,a){return new Array(t).fill(0).map((i,u)=>new Array(n-u%2).fill(0).map((o,p)=>new Nt(p,u,a)))}handlePaintEvent(t,n){let a=this.cellFromElement(t);if(this.element().classList.contains("pick")){n.setCurrentColour(a.currentColour());return}a.paint(n.currentColour())}handleMouseEvent(t,n){let a=t.target;!a||!a.matches(".cell")||(this.handleMoveEvent(a),t.buttons&1&&this.handlePaintEvent(a,n),t.buttons&2&&(this.cellFromElement(a).clear(),t.stopPropagation()),t.preventDefault())}handleMoveEvent(t){dt(s(this,E)),f(this,E,t),mt(s(this,E))}handleTouchEvent(t,n){[...t.touches].forEach(a=>{let i=Vt(a.pageX,a.pageY);!i||!i.matches(".cell")||(this.handleMoveEvent(i),this.handlePaintEvent(i,n),t.preventDefault())})}};q=new WeakMap,E=new WeakMap;var Kt=ft;var gt=class extends g{constructor(){super("p.footer",y("small",k("This site is not affiliated with Aquabeads\xAE or EPOCH. Aquabeads\xAE is a registered trademark of EPOCH.")))}},Gt=gt;var Et=class{static encode(e){return C(this,null,function*(){return new Promise(t=>{let n=new FileReader;n.addEventListener("load",()=>t(n.result)),n.readAsDataURL(new Blob([e]))}).then(t=>t.split(",",2)[1])})}static decode(e){let t=`data:application/octet-binary;base64,${e}`;return fetch(t).then(n=>n.arrayBuffer()).then(n=>new Uint8Array(n))}},bt=Et;var vt=class{static compress(e,t="deflate"){let n=new TextEncoder().encode(e),a=new CompressionStream(t),i=a.writable.getWriter();return i.write(n),i.close(),new Response(a.readable).arrayBuffer().then(u=>new Uint8Array(u))}static decompress(e,t="deflate"){let n=new DecompressionStream(t),a=n.writable.getWriter();return a.write(e),a.close(),new Response(n.readable).arrayBuffer().then(i=>new TextDecoder().decode(i))}static isAvailable(){return"CompressionStream"in window&&"DecompressionStream"in window}},Y=vt;var zt=(r=26,e=22)=>({board:{height:r,width:e},entries:new Array(r*e-Math.floor(r/2)).fill(0),lookup:["transparent"],palette:["#ff0000","#ff8800","#ffff88","#ffff00","#88ff00","#00ff88","#88ffff","#00ffff","#0088ff","#8800ff","#ff00ff","#ff0088","#ff88ff","#000000","#888888","#ffffff"]}),A,At=class{constructor(){b(this,A,zt())}board(){return s(this,A).board}coordsToIndex(e,t){let{width:n}=this.board();return n*t-Math.floor(t/2)+e}static fromString(e){return C(this,null,function*(){if(e.length<3)return null;try{return JSON.parse(atob(e))}catch(t){}try{return JSON.parse(yield Y.decompress(yield bt.decode(e)))}catch(t){return console.debug("There was an error decoding the hash state:"),console.debug(t),null}})}init(e=null){return C(this,null,function*(){let t=yield At.fromString(e);!t||f(this,A,t)})}getEntry(e,t){return s(this,A).lookup[s(this,A).entries[this.coordsToIndex(e,t)]]}palette(){return s(this,A).palette}setEntry(e,t,n){s(this,A).lookup.includes(n)||s(this,A).lookup.push(n),s(this,A).entries[this.coordsToIndex(e,t)]=s(this,A).lookup.indexOf(n)}toString(){return C(this,arguments,function*(e=s(this,A)){return Y.isAvailable()?Y.compress(JSON.stringify(e)).then(t=>bt.encode(t)):btoa(JSON.stringify(e))})}},wt=At;A=new WeakMap;var jt=wt;var _=new jt;_.init(window.location.hash.slice(1)).then(()=>{let r=new Bt(_),e=new Kt(r,_),t=new Ft(e,_),n=new Gt;document.getElementById("app").append(t.element(),e.element(),r.element(),n.element())});window.addEventListener("hashchange",()=>window.location.reload());})();
//# sourceMappingURL=app.js.map
