(()=>{var ot=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var i=(r,e,t)=>(ot(r,e,"read from private field"),t?t.call(r):e.get(r)),l=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},f=(r,e,t,n)=>(ot(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);var S=(r,e,t)=>new Promise((n,s)=>{var a=b=>{try{m(t.next(b))}catch(g){s(g)}},d=b=>{try{m(t.throw(b))}catch(g){s(g)}},m=b=>b.done?n(b.value):Promise.resolve(b.value).then(a,d);m((t=t.apply(r,e)).next())});var u;(function(r){r.Attribute="attribute",r.Pseudo="pseudo",r.PseudoElement="pseudo-element",r.Tag="tag",r.Universal="universal",r.Adjacent="adjacent",r.Child="child",r.Descendant="descendant",r.Parent="parent",r.Sibling="sibling",r.ColumnCombinator="column-combinator"})(u||(u={}));var E;(function(r){r.Any="any",r.Element="element",r.End="end",r.Equals="equals",r.Exists="exists",r.Hyphen="hyphen",r.Not="not",r.Start="start"})(E||(E={}));var ht=/^[^\\#]?(?:\\(?:[\da-f]{1,6}\s?|.)|[\w\-\u00b0-\uFFFF])+/,gt=/\\([\da-f]{1,6}\s?|(\s)|.)/gi,wt=new Map([[126,E.Element],[94,E.Start],[36,E.End],[42,E.Any],[33,E.Not],[124,E.Hyphen]]),Ct=new Set(["has","not","matches","is","where","host","host-context"]);function pt(r){switch(r.type){case u.Adjacent:case u.Child:case u.Descendant:case u.Parent:case u.Sibling:case u.ColumnCombinator:return!0;default:return!1}}var yt=new Set(["contains","icontains"]);function At(r,e,t){let n=parseInt(e,16)-65536;return n!==n||t?e:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,n&1023|56320)}function q(r){return r.replace(gt,At)}function W(r){return r===39||r===34}function ut(r){return r===32||r===9||r===10||r===12||r===13}function $(r){let e=[],t=dt(e,`${r}`,0);if(t<r.length)throw new Error(`Unmatched selector: ${r.slice(t)}`);return e}function dt(r,e,t){let n=[];function s(p){let o=e.slice(t+p).match(ht);if(!o)throw new Error(`Expected name, found ${e.slice(t)}`);let[h]=o;return t+=p+h.length,q(h)}function a(p){for(t+=p;t<e.length&&ut(e.charCodeAt(t));)t++}function d(){t+=1;let p=t,o=1;for(;o>0&&t<e.length;t++)e.charCodeAt(t)===40&&!m(t)?o++:e.charCodeAt(t)===41&&!m(t)&&o--;if(o)throw new Error("Parenthesis not matched");return q(e.slice(p,t-1))}function m(p){let o=0;for(;e.charCodeAt(--p)===92;)o++;return(o&1)===1}function b(){if(n.length>0&&pt(n[n.length-1]))throw new Error("Did not expect successive traversals.")}function g(p){if(n.length>0&&n[n.length-1].type===u.Descendant){n[n.length-1].type=p;return}b(),n.push({type:p})}function rt(p,o){n.push({type:u.Attribute,name:p,action:o,value:s(1),namespace:null,ignoreCase:"quirks"})}function at(){if(n.length&&n[n.length-1].type===u.Descendant&&n.pop(),n.length===0)throw new Error("Empty sub-selector");r.push(n)}if(a(0),e.length===t)return t;t:for(;t<e.length;){let p=e.charCodeAt(t);switch(p){case 32:case 9:case 10:case 12:case 13:{(n.length===0||n[0].type!==u.Descendant)&&(b(),n.push({type:u.Descendant})),a(1);break}case 62:{g(u.Child),a(1);break}case 60:{g(u.Parent),a(1);break}case 126:{g(u.Sibling),a(1);break}case 43:{g(u.Adjacent),a(1);break}case 46:{rt("class",E.Element);break}case 35:{rt("id",E.Equals);break}case 91:{a(1);let o,h=null;e.charCodeAt(t)===124?o=s(1):e.startsWith("*|",t)?(h="*",o=s(2)):(o=s(0),e.charCodeAt(t)===124&&e.charCodeAt(t+1)!==61&&(h=o,o=s(1))),a(0);let w=E.Exists,it=wt.get(e.charCodeAt(t));if(it){if(w=it,e.charCodeAt(t+1)!==61)throw new Error("Expected `=`");a(2)}else e.charCodeAt(t)===61&&(w=E.Equals,a(1));let j="",F=null;if(w!=="exists"){if(W(e.charCodeAt(t))){let K=e.charCodeAt(t),M=t+1;for(;M<e.length&&(e.charCodeAt(M)!==K||m(M));)M+=1;if(e.charCodeAt(M)!==K)throw new Error("Attribute value didn't end");j=q(e.slice(t+1,M)),t=M+1}else{let K=t;for(;t<e.length&&(!ut(e.charCodeAt(t))&&e.charCodeAt(t)!==93||m(t));)t+=1;j=q(e.slice(K,t))}a(0);let st=e.charCodeAt(t)|32;st===115?(F=!1,a(1)):st===105&&(F=!0,a(1))}if(e.charCodeAt(t)!==93)throw new Error("Attribute selector didn't terminate");t+=1;let bt={type:u.Attribute,name:o,action:w,value:j,namespace:h,ignoreCase:F};n.push(bt);break}case 58:{if(e.charCodeAt(t+1)===58){n.push({type:u.PseudoElement,name:s(2).toLowerCase(),data:e.charCodeAt(t)===40?d():null});continue}let o=s(1).toLowerCase(),h=null;if(e.charCodeAt(t)===40)if(Ct.has(o)){if(W(e.charCodeAt(t+1)))throw new Error(`Pseudo-selector ${o} cannot be quoted`);if(h=[],t=dt(h,e,t+1),e.charCodeAt(t)!==41)throw new Error(`Missing closing parenthesis in :${o} (${e})`);t+=1}else{if(h=d(),yt.has(o)){let w=h.charCodeAt(0);w===h.charCodeAt(h.length-1)&&W(w)&&(h=h.slice(1,-1))}h=q(h)}n.push({type:u.Pseudo,name:o,data:h});break}case 44:{at(),n=[],a(1);break}default:{if(e.startsWith("/*",t)){let w=e.indexOf("*/",t+2);if(w<0)throw new Error("Comment was not terminated");t=w+2,n.length===0&&a(0);break}let o=null,h;if(p===42)t+=1,h="*";else if(p===124){if(h="",e.charCodeAt(t+1)===124){g(u.ColumnCombinator),a(2);break}}else if(ht.test(e.slice(t)))h=s(0);else break t;e.charCodeAt(t)===124&&e.charCodeAt(t+1)!==124&&(o=h,e.charCodeAt(t+1)===42?(h="*",t+=2):h=s(1)),n.push(h==="*"?{type:u.Universal,namespace:o}:{type:u.Tag,name:h,namespace:o})}}}return at(),t}var J=r=>{for(;r.hasChildNodes();)r.firstChild.remove()},x=(r,e,t,n)=>r.addEventListener(e,t,n),L=(r,e,t,n)=>{e.forEach(s=>x(r,s,t,n))},c=(r,...e)=>{let[t]=$(r).map(n=>n.reduce((s,a)=>{var d;return s===null&&a.type!=="tag"&&(s=document.createElement("div")),a.type==="tag"?document.createElement(a.name):(a.type==="attribute"&&a.name!=="class"&&s.setAttribute(a.name,(d=a.value)!=null?d:""),a.type==="attribute"&&a.name==="class"&&s.classList.add(a.value),s)},null));return e.forEach(n=>t.append(n)),t},k=r=>document.createTextNode(r),B,_=class{constructor(e,...t){l(this,B,void 0);f(this,B,c(e,...t))}on(e,t,n){x(this.element(),e,t,n)}onEach(e,t,n){L(this.element(),e,t,n)}append(...e){return this.element().append(...e)}element(){return i(this,B)}empty(){J(this.element())}};B=new WeakMap;var C=_;var Q=class extends C{constructor(e,t){super("section.actions");let n=c('button.clear[title="Clear"]',k("\u274C"));L(n,["mousedown","touchstart"],()=>{e.clear(),window.location.hash=""});let s=c('button.link[title="Generate link"]',k("\u{1F517}"));L(s,["mousedown","touchstart"],()=>t.toString().then(m=>window.location.hash="#"+m));let a=c('button.print[title="Print design"]',k("\u{1F5A8}"));L(a,["mousedown","touchstart"],()=>window.print());let d=c('button.print[title="Share design"]');d.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30"><path d="M23 3a4 4 0 0 0-4 4 4 4 0 0 0 .094.836l-9.082 4.541A4 4 0 0 0 7 11a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 3.014-1.375l9.076 4.54A4 4 0 0 0 19 23a4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4 4 4 0 0 0-3.014 1.375l-9.076-4.54A4 4 0 0 0 11 15a4 4 0 0 0-.094-.834l9.082-4.541A4 4 0 0 0 23 11a4 4 0 0 0 4-4 4 4 0 0 0-4-4z"/></svg>',L(d,["mousedown","touchstart"],()=>S(this,null,function*(){return navigator.share({text:"Check out my Aquabeads\xAE design!",title:"Aquabeads\xAE Designer",url:"#"+(yield t.toString())})})),this.append(n,s,a),navigator.share&&this.append(d)}},lt=Q;var O,U,T,H,D,z=class extends C{constructor(t,n,s,a){super(".cell");l(this,O,"transparent");l(this,U,void 0);l(this,T,void 0);l(this,H,void 0);l(this,D,void 0);f(this,U,s),f(this,T,a),f(this,H,t),f(this,D,n),this.bindEvents(),this.paint(a.getEntry(t,n))}bindEvents(){this.on("paint",()=>this.paint())}clear(){this.paint("transparent")}paint(t){typeof t=="undefined"&&(t=i(this,U).currentColour()),f(this,O,t),this.element().style.backgroundColor=i(this,O),i(this,T).getEntry(i(this,H),i(this,D))!==t&&i(this,T).setEntry(i(this,H),i(this,D),i(this,O))}};O=new WeakMap,U=new WeakMap,T=new WeakMap,H=new WeakMap,D=new WeakMap;var ft=z;var N,V=class extends C{constructor(t,n){super("section.board");l(this,N,void 0);let{height:s,width:a}=n.board();f(this,N,this.generateCells(s,a,t,n)),i(this,N).forEach(d=>this.append(c(".row",...d.map(m=>m.element())))),this.bindEvents()}bindEvents(){this.onEach(["mousedown","mousemove","touchstart","touchmove"],t=>{if(!(t instanceof MouseEvent&&(t.buttons&1)===0)){if(t instanceof TouchEvent){t.preventDefault(),[...t.touches].forEach(n=>{let s=document.elementFromPoint(n.pageX,n.pageY);!s.matches(".cell")||s.dispatchEvent(new CustomEvent("paint"))});return}t.target.dispatchEvent(new CustomEvent("paint"))}})}clear(){i(this,N).flat().forEach(t=>t.clear())}generateCells(t,n,s,a){return new Array(t).fill(0).map((d,m)=>new Array(n-m%2).fill(0).map((b,g)=>new ft(g,m,s,a)))}};N=new WeakMap;var ct=V;var X=class extends C{constructor(){super("p.footer",c("small",k("This site is not affiliated with Aquabeads\xAE or EPOCH. Aquabeads\xAE is a registered trademark of EPOCH."),c("br"),k("Some icons courtesy of "),c('a[href="https://icons8.com/"][target="_blank"]',k("icons8.com")),k(".")))}},mt=X;var kt=16,y,P,A,Y=class extends C{constructor(t){super("section.picker");l(this,y,void 0);l(this,P,void 0);l(this,A,void 0);f(this,A,t.palette()),f(this,y,c('input[type="color"]')),i(this,y).value=i(this,A)[0],f(this,P,c("section.recent")),this.append(i(this,y),i(this,P)),this.bindEvents(),this.updateRecent()}bindEvents(){x(i(this,y),"input",()=>{let t=i(this,y).value,n=i(this,A).indexOf(t);n>-1&&i(this,A).splice(n,1),i(this,A).unshift(t),i(this,A).splice(kt),this.updateRecent()})}currentColour(){return i(this,y).value}updateRecent(){J(i(this,P)),i(this,P).append(...i(this,A).map(t=>{let n=c("button");return n.style.backgroundColor=t,L(n,["mousedown","touchstart"],()=>i(this,y).value=t),n}))}};y=new WeakMap,P=new WeakMap,A=new WeakMap;var vt=Y;var Z=class{static encode(e){return S(this,null,function*(){return new Promise(t=>{let n=new FileReader;n.addEventListener("load",()=>t(n.result)),n.readAsDataURL(new Blob([e]))}).then(t=>t.split(",",2)[1])})}static decode(e){let t=`data:application/octet-binary;base64,${e}`;return fetch(t).then(n=>n.arrayBuffer()).then(n=>new Uint8Array(n))}},I=Z;var tt=class{static compress(e,t="deflate"){let n=new TextEncoder().encode(e),s=new CompressionStream(t),a=s.writable.getWriter();return a.write(n),a.close(),new Response(s.readable).arrayBuffer().then(d=>new Uint8Array(d))}static decompress(e,t="deflate"){let n=new DecompressionStream(t),s=n.writable.getWriter();return s.write(e),s.close(),new Response(n.readable).arrayBuffer().then(a=>new TextDecoder().decode(a))}static isAvailable(){return"CompressionStream"in window&&"DecompressionStream"in window}},G=tt;var St=(r=26,e=22)=>({board:{height:r,width:e},entries:new Array(26*22-Math.floor(r/2)).fill(0),lookup:["transparent"],palette:["#ff0000","#ff8800","#ffff88","#ffff00","#88ff00","#00ff88","#88ffff","#00ffff","#0088ff","#8800ff","#ff00ff","#ff0088","#ff88ff","#000000","#888888","#ffffff"]}),v,nt=class{constructor(){l(this,v,St())}board(){return i(this,v).board}coordsToIndex(e,t){let{width:n}=this.board();return n*t-Math.floor(t/2)+e}static fromString(e){return S(this,null,function*(){if(e.length<3)return null;try{return JSON.parse(atob(e))}catch(t){}try{return JSON.parse(yield G.decompress(yield I.decode(e)))}catch(t){return console.debug("There was an error decoding the hash state:"),console.debug(t),null}})}init(e=null){return S(this,null,function*(){let t=yield nt.fromString(e);!t||f(this,v,t)})}getEntry(e,t){return i(this,v).lookup[i(this,v).entries[this.coordsToIndex(e,t)]]}palette(){return i(this,v).palette}setEntry(e,t,n){i(this,v).lookup.includes(n)||i(this,v).lookup.push(n),i(this,v).entries[this.coordsToIndex(e,t)]=i(this,v).lookup.indexOf(n)}toString(){return S(this,null,function*(){return G.isAvailable()?G.compress(JSON.stringify(i(this,v))).then(e=>I.encode(e)):btoa(JSON.stringify(i(this,v)))})}},et=nt;v=new WeakMap;var Et=et;var R=new Et;R.init(window.location.hash.slice(1)).then(()=>{let r=new vt(R),e=new ct(r,R),t=new lt(e,R),n=new mt;document.getElementById("app").append(t.element(),e.element(),r.element(),n.element())});window.addEventListener("hashchange",()=>window.location.reload());})();
//# sourceMappingURL=app.js.map
